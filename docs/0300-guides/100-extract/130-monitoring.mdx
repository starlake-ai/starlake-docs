---
title: "Monitor Starlake Data Extractions (SL_LAST_EXPORT Audit Table)"
description: "Monitor Starlake data extractions using the SL_LAST_EXPORT audit table. Query extraction status, detect failures, and track row counts. Includes SQL examples and audit configuration."
keywords: [starlake, monitoring, SL_LAST_EXPORT, audit, extraction tracking, observability]
---

import Head from '@docusaurus/Head';

<Head>
  <script type="application/ld+json">
    {JSON.stringify({
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Where does Starlake store the extraction history?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "In the SL_LAST_EXPORT table of the audit schema (audit by default). The connection to the audit schema is configured in metadata/application.sl.yml."
          }
        },
        {
          "@type": "Question",
          "name": "What information does the SL_LAST_EXPORT table contain?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "It contains: the schema name (domain), the table name (schema), the timestamp of the last extraction (last_ts), the mode (FULL or INCREMENTAL), the number of rows extracted (count), the success status (success), and an optional error message (message)."
          }
        },
        {
          "@type": "Question",
          "name": "How do I detect failed extractions?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Query the SL_LAST_EXPORT table with the filter WHERE success = false. You can add a time filter, for example AND last_ts >= CURRENT_TIMESTAMP - INTERVAL '24 hours'."
          }
        },
        {
          "@type": "Question",
          "name": "How do I configure the audit schema connection?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "In metadata/application.sl.yml, section audit, define domain (audit schema name) and sink.connectionRef (reference to a JDBC connection defined in the connections section)."
          }
        },
        {
          "@type": "Question",
          "name": "How do I detect anomalies in extracted data volume?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Monitor the count field in SL_LAST_EXPORT. A sudden drop in row count may indicate a problem in the source data or connectivity."
          }
        }
      ]
    })}
  </script>
</Head>

# Monitor Starlake Data Extractions

Starlake keeps track of the successive extractions in the table `SL_LAST_EXPORT` located in the audit schema (`audit` by default).

The connection to the audit schema is defined in the `metadata/application.sl.yml` file.

```yaml
version: 1
application:
  audit:
    domain: "audit" # Schema name
    sink:
      connectionRef: "audit_connection" # Connection to the audit schema

  connections:
    audit_connection:
      type: "jdbc"
      options:
        url: "jdbc:duckdb:{{SL_ROOT}}/datasets/duckdb.db" # Location of the DuckDB database
        driver: "org.duckdb.DuckDBDriver"
    ...
```

## SL_LAST_EXPORT Table Schema

The `SL_LAST_EXPORT` table stores the state of each extraction. Its main columns are:

| Column | Type | Description |
|--------|------|-------------|
| `domain` | VARCHAR | The schema name (e.g., `starbake`) |
| `schema` | VARCHAR | The table name that was extracted |
| `last_ts` | TIMESTAMP | Timestamp of the last extraction run |
| `last_date` | VARCHAR | Date string of the last extraction |
| `last_long` | BIGINT | Last exported value of the partition column (for incremental extractions) |
| `last_string` | VARCHAR | Last exported string value of the partition column |
| `mode` | VARCHAR | Extraction mode (`FULL` or `INCREMENTAL`) |
| `count` | BIGINT | Number of rows extracted in the last run |
| `success` | BOOLEAN | Whether the extraction completed successfully |
| `message` | VARCHAR | Error or status message |
| `step` | VARCHAR | The extraction step |

## Querying the Last Export

You can query the audit table directly to verify the status of your extractions:

```sql
-- Check the last export for all tables in the starbake schema
SELECT domain, schema, last_ts, last_long, mode, count, success
FROM audit.SL_LAST_EXPORT
WHERE domain = 'starbake'
ORDER BY last_ts DESC;
```

```sql
-- Find failed extractions in the last 24 hours
SELECT domain, schema, last_ts, message
FROM audit.SL_LAST_EXPORT
WHERE success = false
  AND last_ts >= CURRENT_TIMESTAMP - INTERVAL '24 hours';
```

## Monitoring Use Case

A typical monitoring workflow is to schedule a check after each extraction pipeline run:

1. **Run the extraction** via `starlake extract-data`.
2. **Query `SL_LAST_EXPORT`** to confirm all expected tables were extracted successfully.
3. **Alert on failures** -- if any row has `success = false`, trigger a notification to your ops team.
4. **Track row counts over time** -- sudden drops in `count` may indicate source data issues or connectivity problems.

## Frequently Asked Questions

### Where does Starlake store the extraction history?
In the `SL_LAST_EXPORT` table of the audit schema (`audit` by default). The connection to the audit schema is configured in `metadata/application.sl.yml`.

### What information does the SL_LAST_EXPORT table contain?
It contains: the schema name (`domain`), the table name (`schema`), the timestamp of the last extraction (`last_ts`), the mode (FULL or INCREMENTAL), the number of rows extracted (`count`), the success status (`success`), and an optional error message (`message`).

### How do I detect failed extractions?
Query the `SL_LAST_EXPORT` table with the filter `WHERE success = false`. You can add a time filter, for example `AND last_ts >= CURRENT_TIMESTAMP - INTERVAL '24 hours'`.

### How do I configure the audit schema connection?
In `metadata/application.sl.yml`, section `audit`, define `domain` (audit schema name) and `sink.connectionRef` (reference to a JDBC connection defined in the `connections` section).

### How do I detect anomalies in extracted data volume?
Monitor the `count` field in `SL_LAST_EXPORT`. A sudden drop in row count may indicate a problem in the source data or connectivity.

