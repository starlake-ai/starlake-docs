---
title: "Load JSON Files"
description: "Load JSON files with nested and repeated attributes into BigQuery, Snowflake, or Databricks using Starlake. Supports JSON, JSON_FLAT, and JSON_ARRAY formats with automatic schema inference."
keywords: [starlake, JSON, load, nested attributes, JSON_ARRAY, JSON_FLAT, schema inference, struct, array]
---

import Head from '@docusaurus/Head';

<Head>
  <script type="application/ld+json">
    {JSON.stringify({
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What JSON formats does Starlake support?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Starlake supports three JSON formats: JSON (one object per line), JSON_FLAT (flat objects without nesting, faster parsing), and JSON_ARRAY (a single array of objects)."
          }
        },
        {
          "@type": "Question",
          "name": "How do I load a JSON file with nested attributes?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Define nested attributes using type: 'struct' in the YAML schema. For repeated (array) attributes, add array: true to the attribute definition."
          }
        },
        {
          "@type": "Question",
          "name": "What is the difference between JSON and JSON_FLAT in Starlake?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "JSON_FLAT is optimized for files where no object contains nested or repeated fields. It parses faster than JSON. Use JSON when your data has nested structures."
          }
        },
        {
          "@type": "Question",
          "name": "How does Starlake detect if a JSON file is an array?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "During autoload, Starlake checks the first character of the file. If it starts with [, the format is JSON_ARRAY. If it starts with {, the format is JSON."
          }
        },
        {
          "@type": "Question",
          "name": "How do I infer the schema of a JSON file?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Run 'starlake infer-schema --input-path incoming/<domain>'. The command detects nested structures and generates the corresponding YAML configuration."
          }
        },
        {
          "@type": "Question",
          "name": "Which data warehouses support nested JSON attributes?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "BigQuery and Databricks natively support nested and repeated attributes (STRUCT and ARRAY types). Snowflake supports them via VARIANT columns. Warehouses like Redshift require flattening."
          }
        }
      ]
    })}
  </script>
</Head>

<Head>
  <script type="application/ld+json">
    {JSON.stringify({
      "@context": "https://schema.org",
      "@type": "HowTo",
      "name": "How to Load a JSON File with Nested Attributes Using Starlake",
      "description": "Load JSON files with nested and repeated attributes into your data warehouse using Starlake.",
      "step": [
        {
          "@type": "HowToStep",
          "position": 1,
          "name": "Infer the JSON schema",
          "text": "Run 'starlake infer-schema --input-path incoming/<domain>' to detect nested structures and generate a YAML configuration."
        },
        {
          "@type": "HowToStep",
          "position": 2,
          "name": "Choose the JSON format",
          "text": "Set metadata.format to JSON, JSON_FLAT (for flat objects), or JSON_ARRAY (for files containing a single array)."
        },
        {
          "@type": "HowToStep",
          "position": 3,
          "name": "Define nested attributes",
          "text": "For nested objects, set type to 'struct'. For arrays, add 'array: true'. Define child attributes under the 'attributes' key."
        },
        {
          "@type": "HowToStep",
          "position": 4,
          "name": "Run the load command",
          "text": "Execute 'starlake load' to parse, validate, and load the JSON data into the target warehouse table."
        }
      ]
    })}
  </script>
</Head>

# Load JSON Files with Nested and Repeated Attributes


Loading a JSON file is similar to loading a CSV file except that JSON attributes may have nested attributes.


## Infer JSON Schema Automatically

The very first step is to infer the schema of the file from a data file as described in the [autoload section](autoload#how-autoload-detects-the-format-of-the-files) before you start customizing your configuration. This is done using the `infer-schema` command. This will bootstrap the configuration file for the table.

```bash

starlake infer-schema --input-path incoming/starbake

```

## JSON Format Options: JSON, JSON_FLAT, JSON_ARRAY

Like other file formats, JSON Parsing options are defined in the `metadata` section of the configuration file.

The `format`attribute may be set to one of the values below:

| Format | Description |
| --- | --- |
| JSON | The JSON file is parsed as a list of objects, one object per line |
| JSON_FLAT | The JSON objects do not contain any repeated or nested fields. Using this format instead of JSON makes file parsing faster |
| JSON_ARRAY | The JSON file is parsed as a single array of objects |

<br/>

```yaml title="metadata/load/<domain>/<table>.sl.yml - parsing section"
table:
  pattern: "order.*.json"
  metadata:
    format: "JSON" # or "JSON_FLAT" since the JSON objects do not contain any repeated or nested fields
    ...
  attributes:
    - ...
```


## Define Nested and Array Attributes in YAML

The `attributes` section of the configuration file is used to define the attributes of the JSON file.
The `attributes` section is a list of objects, each object representing an attribute of the JSON file.
In addition to the common attributes, the `attributes` section may contain the following attributes:
- 'array' (optional): The attribute is an array of objects. The value of this attribute is a list of objects, each object representing an attribute of the array.
- 'struct' (optional): The attribute is an object containing other attributes.

<br/>

Given the Json record below:

```json
{
  "order_id": 1,
  "order_date": "2021-01-01",
  "order_lines": [
    {
      "line_id": 1,
      "product_id": 1,
      "quantity": 2
    },
    {
      "line_id": 2,
      "product_id": 2,
      "quantity": 3
    }
  ]
}
```

The `attributes` section of the configuration file would be:

```yaml title="metadata/load/<domain>/<table>.sl.yml - attributes section"
table:
  pattern: "order.*.json"
  metadata:
    format: "JSON"
    ...
  attributes:
    - name: "order_id"
      type: "integer"
    - name: "order_date"
      type: "date"
    - name: "order_lines"
      type: "struct"
      array: true
      attributes:
        - name: "line_id"
          type: "integer"
        - name: "product_id"
          type: "integer"
        - name: "quantity"
          type: "integer"
```

## Frequently Asked Questions

### What JSON formats does Starlake support?
Starlake supports three JSON formats: `JSON` (one object per line), `JSON_FLAT` (flat objects without nesting, faster parsing), and `JSON_ARRAY` (a single array of objects).

### How do I load a JSON file with nested attributes?
Define nested attributes using `type: "struct"` in the YAML schema. For repeated (array) attributes, add `array: true` to the attribute definition.

### What is the difference between JSON and JSON_FLAT in Starlake?
`JSON_FLAT` is optimized for files where no object contains nested or repeated fields. It parses faster than `JSON`. Use `JSON` when your data has nested structures.

### How does Starlake detect if a JSON file is an array?
During autoload, Starlake checks the first character of the file. If it starts with `[`, the format is `JSON_ARRAY`. If it starts with `{`, the format is `JSON`.

### Can I load JSON files with mixed nesting levels?
Yes. Define each nesting level in the `attributes` section using `type: "struct"` for objects and `array: true` for arrays of objects.

### How do I infer the schema of a JSON file?
Run `starlake infer-schema --input-path incoming/<domain>`. The command detects nested structures and generates the corresponding YAML configuration.

### Which data warehouses support nested JSON attributes?
BigQuery and Databricks natively support nested and repeated attributes (STRUCT and ARRAY types). Snowflake supports them via VARIANT columns. Warehouses like Redshift require flattening.
